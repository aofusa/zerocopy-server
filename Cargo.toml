[package]
name = "zerocopy-server"
version = "0.1.0"
edition = "2021"

[features]
default = []

# kTLS（Kernel TLS）サポート
# rustls + ktls2 を使用し、kTLS によるカーネルオフロードをサポート
# 
# 要件:
#   - Linux 5.15+ カーネル
#   - `modprobe tls` でkTLSモジュールをロード済み
#   - AES-GCM暗号スイートの使用
# 
# ビルド方法: cargo build --features ktls
ktls = ["ktls2"]

[dependencies]
monoio = { version = "0.2.2", features = ["poll-io"] }
# rustls を直接使用（ハンドシェイク後に kTLS へオフロード）
rustls = { version = "0.23", features = ["tls12", "ring"] }
webpki-roots = "0.26"
rustls-pemfile = "2.1.3"
libc = "0.2"
mimalloc = { version = "0.1.43", default-features = false }
# Huge Pages (Large OS Pages) 設定用
# mimallocの低レベルAPIを使用してLarge OS Pagesを有効化
# extendedフィーチャーでmi_option_set等のAPIを使用可能に
libmimalloc-sys = { version = "0.1", features = ["extended"] }
toml = "0.8.19"
serde = { version = "1.0.209", features = ["derive"] }
httparse = "1.9.4"
memchr = "2.7"
bytes = "1.7.1"
anyhow = "1.0.89"
mime_guess = "2.0.5"
num_cpus = "1.17.0"
ftlog = "0.2"
time = "0.3"
hostname = "0.4"
itoa = "1.0"
ctrlc = "3.4"

# CPUアフィニティ設定
# 各ワーカースレッドを特定のCPUコアに固定し、キャッシュ効率を向上
core_affinity = "0.8"

# ktls2（オプション）
# rustls からシークレットを取得して kTLS を有効化
ktls2 = { version = "6.0", optional = true }

# 高速ルーティング（Radix Tree）
# O(n)線形探索からO(log n)に改善
matchit = "0.8"

# 設定のホットリロード対応
# ロックフリーな設定更新を実現
arc-swap = "1.7"
once_cell = "1.20"
signal-hook = "0.3.18"

# Prometheusメトリクス対応
# リクエスト数、レイテンシ、エラー率などを計測・エクスポート
prometheus = "0.13"
clap = { version = "4.5.53", features = ["derive"] }
